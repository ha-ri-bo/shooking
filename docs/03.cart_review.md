# 장바구니 페이지 리뷰

## 고객사 요구사항
> 이메일에 작성된 요구 사항 외에 피그마 시안에 있는 세부적인 요구사항을 추가해주시면 됩니다.

## 요구사항에 따른 기능 동작 확인
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const path = require('path');
const { Schema } = mongoose;
const React = require('react');
const ReactDOMServer = require('react-dom/server');
const { BrowserRouter, Routes, Route, Link, useParams } = require('react-router-dom');
const axios = require('axios');

// Express 서버 설정
const app = express();
app.use(cors());
app.use(express.json());

mongoose.connect('mongodb://localhost/shoe-store', {
    useNewUrlParser: true,
    useUnifiedTopology: true,
}).then(() => console.log('MongoDB connected'))
  .catch((error) => console.log('MongoDB connection error:', error));

// MongoDB 모델 정의
const productSchema = new Schema({
    name: String,
    description: String,
    imageUrl: String,
});

const cartItemSchema = new Schema({
    product: { type: Schema.Types.ObjectId, ref: 'Product', required: true },
    quantity: { type: Number, required: true },
}, { timestamps: true });

const Product = mongoose.model('Product', productSchema);
const Cart = mongoose.model('Cart', cartItemSchema);

// API 라우트 - 장바구니
app.post('/api/cart', async (req, res) => {
    const { product, quantity } = req.body;
    const cartItem = new Cart({ product, quantity });
    try {
        const savedCartItem = await cartItem.save();
        res.status(201).json(savedCartItem);
    } catch (error) {
        res.status(400).json({ message: error.message });
    }
});

app.get('/api/cart', async (req, res) => {
    try {
        const cartItems = await Cart.find().populate('product');
        res.json(cartItems);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

// React 컴포넌트
function CartPage() {
    const [cartItems, setCartItems] = React.useState([]);

    React.useEffect(() => {
        const fetchCartItems = async () => {
            const { data } = await axios.get('/api/cart');
            setCartItems(data);
        };
        fetchCartItems();
    }, []);

    return (
        <div>
            <h1>Shopping Cart</h1>
            {cartItems.length === 0 ? (
                <p>Your cart is empty</p>
            ) : (
                <ul>
                    {cartItems.map(item => (
                        <li key={item._id}>
                            {item.product.name} - {item.quantity} pcs
                        </li>
                    ))}
                </ul>
            )}
            <p>Total Items: {cartItems.reduce((acc, item) => acc + item.quantity, 0)}</p>
        </div>
    );
}

function ProductPage() {
    const { id } = useParams();
    const [product, setProduct] = React.useState({});

    React.useEffect(() => {
        const fetchProduct = async () => {
            const { data } = await axios.get(`/api/products/${id}`);
            setProduct(data);
        };
        fetchProduct();
    }, [id]);

    return (
        <div>
            <h1>{product.name}</h1>
            <img src={product.imageUrl} alt={product.name} style={{ width: '100%', height: 'auto' }} />
            <p>{product.description}</p>
        </div>
    );
}

function HomePage() {
    const [products, setProducts] = React.useState([]);

    React.useEffect(() => {
        const fetchProducts = async () => {
            const { data } = await axios.get('/api/products');
            setProducts(data);
        };
        fetchProducts();
    }, []);

    return (
        <div>
            <h1>Welcome to the Shoe Store</h1>
            <ul>
                {products.map(product => (
                    <li key={product._id}>
                        <Link to={`/product/${product._id}`}>
                            <img src={product.imageUrl} alt={product.name} style={{ width: '100px', height: 'auto' }} />
                            {product.name}
                        </Link>
                    </li>
                ))}
            </ul>
            <Link to="/cart">Go to Cart</Link>
        </div>
    );
}

function App() {
    return (
        <BrowserRouter>
            <Routes>
                <Route path="/" element={<HomePage />} />
                <Route path="/cart" element={<CartPage />} />
                <Route path="/product/:id" element={<ProductPage />} />
            </Routes>
        </BrowserRouter>
    );
}

// 서버 사이드 렌더링
const appMarkup = ReactDOMServer.renderToString(<App />);
console.log(appMarkup);

// 서버 실행
app.listen(5000, () => console.log('Server running on port 5000'));
